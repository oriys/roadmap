import type { LessonGuide } from "../types"
import type { QuizQuestion } from "@/lib/types"

export const week8Guides: Record<string, LessonGuide> = {
    "tm-8-1": {
        lessonId: "tm-8-1",
        background: [
            "【技术债务定义】Ward Cunningham 最早提出技术债务概念：'将不完全正确的代码发布，就像负债一样。小额的债务可以加速开发，但利息会累积，如果债务不被偿还，最终会使整个工程停滞。'",
            "【Martin Fowler 四象限】Martin Fowler 提出技术债务四象限模型，用两个维度分类：Deliberate（故意）vs Inadvertent（无意）、Prudent（审慎）vs Reckless（鲁莽）。四种组合代表不同性质的债务。",
            "【审慎-故意】'我们必须现在发布，稍后处理后果'——团队知道在承担债务，有明确的偿还计划。这是战略性技术债务，可以被管理。",
            "【审慎-无意】'现在我们才知道应该怎么做'——随着对领域理解的深入，发现之前的设计不够好。这是学习的自然结果，不可避免。",
            "【鲁莽-故意】'我们没时间做设计'——故意走捷径又不打算偿还。这是最危险的债务类型，通常源于不良的工程文化。",
            "【鲁莽-无意】'什么是分层架构？'——因为能力不足而产生的债务。解决方案是培训和技术指导，而非简单的重构。"
        ],
        keyDifficulties: [
            "【识别隐性债务】显性债务（如 TODO 注释）容易识别，隐性债务（如架构腐化）难以发现。需要定期代码审计和架构评审。",
            "【量化困难】技术债务难以精确量化。虽然有工具（如 SonarQube）可以测量代码质量指标，但与业务影响的关联需要人工判断。",
            "【债务归因】区分债务类型需要理解历史上下文。当时的'审慎决策'可能因为信息不对称而看起来像'鲁莽'。",
            "【债务蔓延】技术债务会通过代码依赖蔓延。一个模块的债务可能影响多个依赖模块，形成债务网络。"
        ],
        handsOnPath: [
            "1. 债务登记：创建技术债务登记表，记录已知债务、类型、影响范围、估计偿还成本",
            "2. 四象限分类：将已识别的债务按 Fowler 四象限分类",
            "3. 代码质量审计：使用 SonarQube 等工具扫描代码库，识别代码级别债务",
            "4. 架构债务评估：评审系统架构，识别架构级别的债务（如紧耦合、单体过大）",
            "5. 债务来源分析：回顾过去三个月新增的债务，分析来源和原因"
        ],
        selfCheck: [
            "你能列出团队当前最严重的三项技术债务吗？它们分别属于哪个象限？",
            "团队是否有系统性记录技术债务的机制？",
            "过去一个季度，有多少债务是'审慎-故意'型？是否有偿还计划？",
            "团队是否有'鲁莽-故意'型债务？这反映了什么文化问题？",
            "新人能否快速了解系统中的已知技术债务？"
        ],
        extensions: [
            "研究 SonarQube 的技术债务计算方法",
            "了解《Managing Technical Debt》一书的系统方法",
            "学习架构债务评估技术（如 ATAM）",
            "研究 CodeScene 的代码健康度分析"
        ],
        sourceUrls: [
            "https://martinfowler.com/bliki/TechnicalDebtQuadrant.html",
            "https://www.amazon.com/Managing-Technical-Debt-Practices-Development/dp/0135645948",
            "https://www.sonarqube.org/"
        ]
    },
    "tm-8-2": {
        lessonId: "tm-8-2",
        background: [
            "【偿还原则】技术债务偿还应该遵循'先高利息后低利息'原则。高利息债务是那些频繁被触及、影响开发速度、或有安全风险的债务。",
            "【Scout Rule】童子军规则：'离开时比来时更干净'。每次修改代码时，顺便改进相关的小债务。持续小改进避免债务累积。",
            "【重构策略】Martin Fowler 在《Refactoring》中强调：重构应该是持续的、小步的，而非大规模的'停业重写'。大重写风险高且往往失败。",
            "【债务预算】健康的团队应该为技术债务偿还分配固定预算，通常建议 20-30% 的工程能力用于技术改进。",
            "【机会成本】推迟偿还债务有机会成本：利息会累积，团队效率下降，招聘和留存变难，紧急情况响应能力降低。"
        ],
        keyDifficulties: [
            "【优先级冲突】业务压力下，技术债务偿还往往被推迟。需要将技术债务影响转化为业务语言，争取资源。",
            "【评估收益】债务偿还的收益难以预先证明。需要建立度量机制，追踪偿还前后的效率变化。",
            "【大规模债务】某些债务累积到一定程度，小步重构不足以解决。需要决策是否进行大规模改造。",
            "【团队动力】长期处理遗留代码会影响团队士气。需要平衡债务偿还与新功能开发，保持团队热情。"
        ],
        handsOnPath: [
            "1. 债务优先级排序：为已识别的债务评估'利息率'（对开发速度的影响），排序优先级",
            "2. 建立债务预算：与管理层协商，为团队分配固定的技术债务偿还时间",
            "3. 童子军规则实践：在下一个 PR 中，顺便改进一处相关的小债务",
            "4. 偿还度量：选择一个已偿还的债务，度量偿还前后的相关指标变化",
            "5. 制定偿还路线图：为最重要的三项债务制定偿还计划"
        ],
        selfCheck: [
            "团队是否有固定的技术债务偿还时间预算？占比多少？",
            "过去一个季度偿还了哪些债务？效果如何评估？",
            "团队是否践行童子军规则？新代码是否带来新债务？",
            "有没有债务累积到必须大规模改造的程度？决策是什么？",
            "团队成员对处理技术债务的态度如何？是否有挫败感？"
        ],
        extensions: [
            "阅读《Working Effectively with Legacy Code》了解遗留代码改造技术",
            "研究 Strangler Fig Pattern 用于渐进式系统重写",
            "学习技术债务可视化工具（如 CodeScene）",
            "了解 Google 的大规模代码库维护实践"
        ],
        sourceUrls: [
            "https://martinfowler.com/bliki/StranglerFigApplication.html",
            "https://www.amazon.com/Working-Effectively-Legacy-Michael-Feathers/dp/0131177052",
            "https://www.amazon.com/Refactoring-Improving-Existing-Addison-Wesley-Signature/dp/0134757599"
        ]
    },
    "tm-8-3": {
        lessonId: "tm-8-3",
        background: [
            "【语言转换】技术人员习惯用技术语言描述债务（'我们需要重构数据库层'），业务方不理解这意味着什么。需要转换为业务语言：影响交付速度、增加运维成本、带来安全风险等。",
            "【投资思维】将技术债务管理框架为'投资'而非'成本'。投资技术改进可以获得回报：更快的交付、更低的事故率、更容易的招聘。",
            "【量化影响】尽可能量化技术债务的业务影响：每次部署需要多少手工步骤？每月因为技术问题损失多少客户支持时间？新功能开发因为债务延迟了多少？",
            "【讲故事技巧】使用具体案例而非抽象概念。'上周的事故修复花了8小时而非应有的30分钟，因为系统没有适当的日志'比'我们需要改进可观测性'更有说服力。",
            "【建立信任】持续交付承诺的技术改进收益，建立技术团队的信誉。如果承诺'重构后部署时间减少50%'，需要跟踪并汇报结果。"
        ],
        keyDifficulties: [
            "【翻译能力】技术管理者需要双语能力：既懂技术细节，又能用业务语言表达。这需要刻意练习。",
            "【期望管理】技术改进的收益往往是渐进的、间接的，难以立竿见影。需要设定合理期望，避免过度承诺。",
            "【竞争资源】技术投资与新功能开发竞争资源。需要展示技术投资如何加速未来功能开发。",
            "【度量挑战】某些技术收益难以量化（如代码可读性提升）。需要组合使用定量和定性证据。"
        ],
        handsOnPath: [
            "1. 影响量化：选择一项技术债务，量化其对开发效率或运维成本的影响",
            "2. 案例准备：收集3个具体案例，说明技术债务如何影响业务",
            "3. 投资提案：用业务语言起草一份技术投资提案，包含投入、预期收益、度量方式",
            "4. 利益相关者地图：识别技术投资决策的关键利益相关者，了解他们的关注点",
            "5. 结果汇报：对已完成的技术改进，向业务方汇报实际收益"
        ],
        selfCheck: [
            "你能用一分钟向非技术领导解释当前最重要的技术债务吗？",
            "业务方是否理解技术投资的必要性？他们的疑虑是什么？",
            "过去的技术投资是否交付了承诺的收益？有什么证据？",
            "技术团队与业务团队的信任关系如何？有什么改进空间？",
            "你是否有持续汇报技术改进收益的机制？"
        ],
        extensions: [
            "学习《Crucial Conversations》提升沟通技巧",
            "研究 Value Stream Mapping 识别浪费",
            "了解 Engineering Effectiveness 指标体系",
            "阅读《The Phoenix Project》了解 IT 与业务协作"
        ],
        sourceUrls: [
            "https://www.amazon.com/Phoenix-Project-DevOps-Helping-Business/dp/1942788290",
            "https://www.amazon.com/Crucial-Conversations-Talking-Stakes-Second/dp/0071771328",
            "https://martinfowler.com/articles/is-quality-worth-cost.html"
        ]
    }
}

export const week8Quizzes: Record<string, QuizQuestion[]> = {
    "tm-8-1": [
        {
            id: "tm-8-1-q1",
            question: "Martin Fowler 技术债务四象限的两个维度是什么？",
            options: [
                "高/低 和 紧急/不紧急",
                "Deliberate（故意）/Inadvertent（无意）和 Prudent（审慎）/Reckless（鲁莽）",
                "技术/业务 和 短期/长期",
                "代码/架构 和 可见/隐藏"
            ],
            answer: 1,
            rationale: "Fowler 四象限用故意/无意和审慎/鲁莽两个维度分类技术债务。"
        },
        {
            id: "tm-8-1-q2",
            question: "'我们必须现在发布，稍后处理后果'属于四象限中的哪类债务？",
            options: [
                "鲁莽-故意",
                "鲁莽-无意",
                "审慎-故意",
                "审慎-无意"
            ],
            answer: 2,
            rationale: "这是审慎-故意型债务，团队知道在承担债务，有明确的权衡和计划。"
        },
        {
            id: "tm-8-1-q3",
            question: "'现在我们才知道应该怎么做'属于哪类债务？",
            options: [
                "审慎-故意",
                "审慎-无意",
                "鲁莽-故意",
                "鲁莽-无意"
            ],
            answer: 1,
            rationale: "这是审慎-无意型债务，是随着对领域理解深入而发现的设计不足，是学习的自然结果。"
        },
        {
            id: "tm-8-1-q4",
            question: "'我们没时间做设计'属于哪类债务？为什么最危险？",
            options: [
                "审慎-故意，因为有计划",
                "鲁莽-故意，因为故意走捷径又不打算偿还",
                "鲁莽-无意，因为能力不足",
                "审慎-无意，因为是学习结果"
            ],
            answer: 1,
            rationale: "这是鲁莽-故意型债务，最危险因为故意走捷径又不打算偿还，通常源于不良的工程文化。"
        },
        {
            id: "tm-8-1-q5",
            question: "技术债务概念最早由谁提出？",
            options: [
                "Martin Fowler",
                "Ward Cunningham",
                "Kent Beck",
                "Robert Martin"
            ],
            answer: 1,
            rationale: "Ward Cunningham 最早提出技术债务概念，用金融债务比喻代码质量问题。"
        },
        {
            id: "tm-8-1-q6",
            question: "鲁莽-无意型债务（'什么是分层架构？'）的解决方案是什么？",
            options: [
                "重构代码",
                "培训和技术指导",
                "增加代码审查",
                "招聘更好的开发者"
            ],
            answer: 1,
            rationale: "鲁莽-无意型债务源于能力不足，解决方案是培训和技术指导，而非简单的重构。"
        },
        {
            id: "tm-8-1-q7",
            question: "隐性技术债务与显性债务的区别是什么？",
            options: [
                "隐性债务成本更低",
                "显性债务如 TODO 注释容易识别，隐性债务如架构腐化难以发现",
                "隐性债务不需要偿还",
                "显性债务是故意的"
            ],
            answer: 1,
            rationale: "显性债务容易识别（如 TODO 注释），隐性债务（如架构腐化）需要代码审计才能发现。"
        },
        {
            id: "tm-8-1-q8",
            question: "技术债务量化的挑战是什么？",
            options: [
                "没有工具可用",
                "代码质量指标与业务影响的关联需要人工判断",
                "债务总是可以精确计算",
                "量化不重要"
            ],
            answer: 1,
            rationale: "虽然有工具测量代码质量指标，但与业务影响的关联需要人工判断，难以精确量化。"
        },
        {
            id: "tm-8-1-q9",
            question: "债务蔓延（Debt Spread）指的是什么？",
            options: [
                "债务会自动消失",
                "一个模块的债务通过代码依赖影响多个模块",
                "债务在团队间传播",
                "债务信息共享"
            ],
            answer: 1,
            rationale: "技术债务会通过代码依赖蔓延，一个模块的债务可能影响多个依赖模块。"
        },
        {
            id: "tm-8-1-q10",
            question: "SonarQube 等工具的主要作用是什么？",
            options: [
                "自动偿还技术债务",
                "测量代码质量指标，识别代码级别债务",
                "管理业务需求",
                "部署代码"
            ],
            answer: 1,
            rationale: "SonarQube 等工具可以扫描代码库，测量代码质量指标，帮助识别代码级别的技术债务。"
        },
        {
            id: "tm-8-1-q11",
            question: "区分债务类型时，为什么需要理解历史上下文？",
            options: [
                "方便追责",
                "当时的'审慎决策'可能因信息不对称而看起来像'鲁莽'",
                "历史记录是合规要求",
                "方便计算债务年龄"
            ],
            answer: 1,
            rationale: "区分债务类型需要理解历史上下文，因为当时的'审慎决策'可能因信息不对称而被误判。"
        },
        {
            id: "tm-8-1-q12",
            question: "技术债务登记表应该包含哪些信息？",
            options: [
                "只需要债务描述",
                "债务、类型、影响范围、估计偿还成本等",
                "只需要负责人",
                "只需要创建日期"
            ],
            answer: 1,
            rationale: "债务登记表应记录债务描述、类型、影响范围、估计偿还成本等关键信息。"
        }
    ],
    "tm-8-2": [
        {
            id: "tm-8-2-q1",
            question: "技术债务偿还应该遵循什么原则？",
            options: [
                "先偿还最老的债务",
                "先高利息后低利息",
                "随机选择偿还",
                "先偿还最容易的债务"
            ],
            answer: 1,
            rationale: "应该'先高利息后低利息'，优先偿还频繁被触及、影响开发速度、有安全风险的债务。"
        },
        {
            id: "tm-8-2-q2",
            question: "童子军规则（Scout Rule）是什么？",
            options: [
                "代码必须通过审查",
                "离开时比来时更干净",
                "每天写测试",
                "每周重构一次"
            ],
            answer: 1,
            rationale: "童子军规则是'离开时比来时更干净'，每次修改代码时顺便改进相关的小债务。"
        },
        {
            id: "tm-8-2-q3",
            question: "Martin Fowler 对重构的建议是什么？",
            options: [
                "大规模重写更高效",
                "重构应该是持续的、小步的",
                "重构应该在项目结束时进行",
                "重构不如重写"
            ],
            answer: 1,
            rationale: "Fowler 强调重构应该是持续的、小步的，而非大规模的'停业重写'，大重写风险高且往往失败。"
        },
        {
            id: "tm-8-2-q4",
            question: "健康团队应该为技术债务偿还分配多少工程能力？",
            options: [
                "5-10%",
                "20-30%",
                "50%以上",
                "不需要专门分配"
            ],
            answer: 1,
            rationale: "建议分配 20-30% 的工程能力用于技术改进，这是债务预算的推荐范围。"
        },
        {
            id: "tm-8-2-q5",
            question: "推迟偿还债务的机会成本包括什么？",
            options: [
                "没有机会成本",
                "利息累积、效率下降、招聘困难、应急能力降低",
                "只有财务成本",
                "只影响代码质量"
            ],
            answer: 1,
            rationale: "推迟偿还债务会导致利息累积、团队效率下降、招聘留存变难、紧急响应能力降低。"
        },
        {
            id: "tm-8-2-q6",
            question: "Strangler Fig Pattern 用于什么场景？",
            options: [
                "新系统开发",
                "渐进式系统重写",
                "代码审查",
                "性能优化"
            ],
            answer: 1,
            rationale: "Strangler Fig Pattern 用于渐进式系统重写，逐步用新系统替代旧系统。"
        },
        {
            id: "tm-8-2-q7",
            question: "债务偿还收益评估的挑战是什么？",
            options: [
                "收益总是立竿见影",
                "收益难以预先证明，需要建立度量机制",
                "没有必要评估收益",
                "收益可以精确计算"
            ],
            answer: 1,
            rationale: "债务偿还的收益难以预先证明，需要建立度量机制，追踪偿还前后的效率变化。"
        },
        {
            id: "tm-8-2-q8",
            question: "长期处理遗留代码对团队的影响是什么？",
            options: [
                "提升技能",
                "可能影响团队士气",
                "没有影响",
                "增加成就感"
            ],
            answer: 1,
            rationale: "长期处理遗留代码会影响团队士气，需要平衡债务偿还与新功能开发，保持热情。"
        },
        {
            id: "tm-8-2-q9",
            question: "《Working Effectively with Legacy Code》的作者是谁？",
            options: [
                "Martin Fowler",
                "Michael Feathers",
                "Robert Martin",
                "Kent Beck"
            ],
            answer: 1,
            rationale: "《Working Effectively with Legacy Code》由 Michael Feathers 撰写，是遗留代码改造的经典著作。"
        },
        {
            id: "tm-8-2-q10",
            question: "什么情况下小步重构不足以解决问题？",
            options: [
                "所有情况都可以小步解决",
                "债务累积到一定程度，需要大规模改造",
                "只有新系统才需要大规模改造",
                "从不需要大规模改造"
            ],
            answer: 1,
            rationale: "某些债务累积到一定程度，小步重构不足以解决，需要决策是否进行大规模改造。"
        },
        {
            id: "tm-8-2-q11",
            question: "技术债务偿还与新功能开发的关系是什么？",
            options: [
                "完全独立",
                "竞争资源，需要平衡",
                "债务偿还更重要",
                "新功能总是优先"
            ],
            answer: 1,
            rationale: "技术债务偿还与新功能开发竞争资源，需要找到平衡点以保持长期效率。"
        },
        {
            id: "tm-8-2-q12",
            question: "'高利息债务'指的是什么？",
            options: [
                "最老的债务",
                "频繁被触及、影响开发速度、有安全风险的债务",
                "代码行数最多的债务",
                "最难修复的债务"
            ],
            answer: 1,
            rationale: "高利息债务是那些频繁被触及、影响开发速度、或有安全风险的债务，应优先偿还。"
        }
    ],
    "tm-8-3": [
        {
            id: "tm-8-3-q1",
            question: "技术人员用技术语言描述债务的问题是什么？",
            options: [
                "技术语言更准确",
                "业务方不理解这意味着什么",
                "技术语言太简单",
                "业务方不关心"
            ],
            answer: 1,
            rationale: "技术语言（如'重构数据库层'）业务方不理解，需要转换为业务语言（影响交付速度、成本、风险）。"
        },
        {
            id: "tm-8-3-q2",
            question: "将技术债务管理框架为什么比'成本'更有效？",
            options: [
                "管理",
                "投资",
                "风险",
                "项目"
            ],
            answer: 1,
            rationale: "将技术债务管理框架为'投资'而非'成本'，强调投资技术改进可以获得回报。"
        },
        {
            id: "tm-8-3-q3",
            question: "使用具体案例而非抽象概念的好处是什么？",
            options: [
                "节省时间",
                "更有说服力，业务方更容易理解",
                "技术细节更完整",
                "方便文档记录"
            ],
            answer: 1,
            rationale: "具体案例比抽象概念更有说服力，如'事故修复花了8小时而非30分钟'比'需要改进可观测性'更易理解。"
        },
        {
            id: "tm-8-3-q4",
            question: "建立技术团队信誉的关键是什么？",
            options: [
                "承诺更多改进",
                "持续交付承诺的技术改进收益，跟踪并汇报结果",
                "避免做承诺",
                "只做容易的改进"
            ],
            answer: 1,
            rationale: "需要持续交付承诺的收益，如果承诺'部署时间减少50%'，需要跟踪并汇报结果建立信任。"
        },
        {
            id: "tm-8-3-q5",
            question: "技术管理者需要什么样的'双语能力'？",
            options: [
                "中文和英文",
                "既懂技术细节，又能用业务语言表达",
                "前端和后端语言",
                "编程语言和脚本语言"
            ],
            answer: 1,
            rationale: "技术管理者需要双语能力：既懂技术细节，又能用业务语言表达，需要刻意练习。"
        },
        {
            id: "tm-8-3-q6",
            question: "技术改进收益的特点是什么？",
            options: [
                "立竿见影",
                "往往是渐进的、间接的",
                "容易量化",
                "无法衡量"
            ],
            answer: 1,
            rationale: "技术改进的收益往往是渐进的、间接的，难以立竿见影，需要设定合理期望。"
        },
        {
            id: "tm-8-3-q7",
            question: "量化技术债务影响时应该关注什么？",
            options: [
                "只关注代码行数",
                "对开发效率或运维成本的具体影响",
                "只关注技术指标",
                "只关注团队规模"
            ],
            answer: 1,
            rationale: "应量化业务影响：每次部署的手工步骤、技术问题导致的支持时间、功能延迟等。"
        },
        {
            id: "tm-8-3-q8",
            question: "《The Phoenix Project》主要讲述什么？",
            options: [
                "编程技巧",
                "IT 与业务协作",
                "项目管理方法",
                "云计算技术"
            ],
            answer: 1,
            rationale: "《The Phoenix Project》是一本小说，讲述 IT 与业务协作的故事，阐述 DevOps 理念。"
        },
        {
            id: "tm-8-3-q9",
            question: "某些技术收益难以量化时应该怎么做？",
            options: [
                "放弃这类改进",
                "组合使用定量和定性证据",
                "只依赖定量数据",
                "让业务方决定"
            ],
            answer: 1,
            rationale: "某些技术收益（如代码可读性提升）难以量化，需要组合使用定量和定性证据。"
        },
        {
            id: "tm-8-3-q10",
            question: "Value Stream Mapping 的作用是什么？",
            options: [
                "设计系统架构",
                "识别价值流中的浪费",
                "管理团队",
                "编写代码"
            ],
            answer: 1,
            rationale: "Value Stream Mapping 用于识别价值流中的浪费，帮助发现技术债务造成的效率损失。"
        },
        {
            id: "tm-8-3-q11",
            question: "技术投资提案应该包含什么？",
            options: [
                "只需要技术方案",
                "投入、预期收益、度量方式",
                "只需要成本估算",
                "只需要时间表"
            ],
            answer: 1,
            rationale: "技术投资提案应用业务语言说明投入、预期收益和度量方式，让业务方理解价值。"
        },
        {
            id: "tm-8-3-q12",
            question: "识别技术投资决策的利益相关者的目的是什么？",
            options: [
                "分配责任",
                "了解他们的关注点，调整沟通策略",
                "减少参与人数",
                "加快决策速度"
            ],
            answer: 1,
            rationale: "识别利益相关者并了解其关注点，可以调整沟通策略，更有效地争取支持。"
        }
    ]
}
