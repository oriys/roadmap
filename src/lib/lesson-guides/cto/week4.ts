import type { LessonGuide } from "../types"
import type { QuizQuestion } from "@/lib/types"

export const week4Guides: Record<string, LessonGuide> = {
  "cto-w4-1": {
    lessonId: "cto-w4-1",
    background: [
      "【ADR 机制】Architecture Decision Records（ADR）是一种轻量级的架构决策记录方式，包含背景、决策、影响和状态，确保重要架构决策可追溯。",
      "【成本模型】架构演进需要评估成本：迁移成本（人力、时间、风险）、运行成本（基础设施、运维）和机会成本（选择 A 意味着放弃 B）。",
      "【风险评估】每个架构演进方案都伴随风险。CTO 需要评估技术风险（方案是否可行）、执行风险（团队是否有能力）和业务风险（是否影响线上稳定性）。",
      "【微服务权衡】微服务不是银弹。拆分微服务会增加分布式系统的复杂性（网络延迟、数据一致性、运维成本）。需要根据团队规模和业务需求审慎决策。",
      "【演进式架构】好的架构不是一步到位设计出来的，而是随着业务理解的深入逐步演进。关键是保持架构的可演进性，避免过早锁定。"
    ],
    keyDifficulties: [
      "【决策偏见】架构决策容易受到技术偏好、简历驱动开发（Resume-Driven Development）等偏见影响。ADR 通过结构化记录帮助减少偏见。",
      "【遗留系统】大多数公司面临遗留系统的挑战。演进路径需要考虑如何在不停机的情况下逐步迁移（Strangler Fig Pattern）。",
      "【过度设计】追求'完美架构'会导致过度设计。YAGNI（You Aren't Gonna Need It）原则提醒我们只解决当前确定需要解决的问题。",
      "【共识建设】重大架构决策需要团队共识。通过 RFC + 评审会的方式让关键利益相关者参与决策过程。"
    ],
    handsOnPath: [
      "创建 ADR 模板（标题、日期、状态、背景、决策、影响），在团队仓库中建立 ADR 目录。",
      "选择一个即将进行的架构改造，使用 ADR 完整记录决策过程。",
      "为该改造方案制作成本模型，包含迁移成本、运行成本和预期收益。",
      "列出方案的 Top 3 风险，并为每个风险制定缓解措施。",
      "与团队进行一次架构评审会，收集反馈并更新 ADR。"
    ],
    selfCheck: [
      "团队是否有结构化记录架构决策的机制？",
      "重大架构决策是否经过成本、风险评估？",
      "你是否清楚当前架构的主要技术债和演进方向？",
      "架构决策是否有团队评审和共识建设的过程？",
      "你是否评估过当前是否真的需要微服务拆分？"
    ],
    extensions: [
      "学习 ADR 的标准格式和工具，如 adr-tools CLI。",
      "研究 Strangler Fig Pattern，了解遗留系统渐进式迁移的方法。",
      "阅读 Microservices Patterns，深入理解微服务架构的权衡。",
      "探索 Architecture Fitness Functions，用自动化方式验证架构属性。"
    ],
    sourceUrls: [
      "https://adr.github.io/",
      "https://microservices.io/"
    ]
  },
  "cto-w4-2": {
    lessonId: "cto-w4-2",
    background: [
      "【平台化识别】通用能力（身份认证、支付、消息推送、数据管道）被多个业务线重复建设时，就是平台化的信号。平台化的目标是复用、标准化和降低边际成本。",
      "【Team Topologies】Team Topologies 提出四种团队类型：Stream-aligned（业务流团队）、Platform（平台团队）、Enabling（赋能团队）和 Complicated Subsystem（复杂子系统团队）。",
      "【内部开发者平台】Internal Developer Platform（IDP）是面向内部开发者的自助式平台，提供标准化的开发、测试、部署和运维能力，减少认知负担。",
      "【平台即产品】平台团队应将内部平台视为产品来运营：明确用户（内部开发者）、收集反馈、迭代改进、衡量采用率和满意度。",
      "【ROI 驱动】平台化投资需要清晰的 ROI 计算：节省的重复开发时间、减少的运维成本、提升的开发者效率和降低的错误率。"
    ],
    keyDifficulties: [
      "【过早平台化】在业务尚未稳定时过早投资平台化，可能导致平台与业务需求脱节。建议在至少 3 个业务场景验证需求后再抽象平台。",
      "【平台孤岛】平台团队容易与业务团队脱节，建设的能力没人用。必须保持与'用户'（业务开发者）的紧密沟通。",
      "【治理平衡】平台的标准化程度需要与业务团队的自主性之间取得平衡。过度标准化会抑制创新，过度自由会导致碎片化。",
      "【衡量价值】平台的价值往往不容易直接量化。需要建立复合指标：采用率、开发者满意度、自助服务比例、工单减少量等。"
    ],
    handsOnPath: [
      "盘点当前跨团队重复建设的能力，列出候选的平台化方向。",
      "选择 ROI 最高的一个方向，制作商业计划书（问题、方案、成本、收益、里程碑）。",
      "设计平台团队的运营模式：如何收集需求、如何排优先级、如何衡量成功。",
      "建立平台采用率和开发者满意度的度量机制。",
      "与业务团队进行一次平台化需求对齐会议，验证方向和优先级。"
    ],
    selfCheck: [
      "你是否识别了当前最值得平台化的通用能力？",
      "平台化投资是否有清晰的 ROI 计算和里程碑？",
      "平台团队是否把内部开发者当作用户来服务？",
      "你是否有平台采用率和满意度的度量机制？",
      "标准化与团队自主性之间的平衡是否合理？"
    ],
    extensions: [
      "阅读 Team Topologies 一书，深入理解四种团队类型的协作模式。",
      "探索 Internal Developer Platform 社区的最佳实践和参考架构。",
      "学习 Platform Engineering 的成熟度模型，评估当前阶段。",
      "研究 Spotify 和 Netflix 的平台化实践案例。"
    ],
    sourceUrls: [
      "https://teamtopologies.com/",
      "https://internaldeveloperplatform.org/"
    ]
  }
}

export const week4Quizzes: Record<string, QuizQuestion[]> = {
  "cto-w4-1": [
    {
      id: "cto-w4-1-q1",
      question: "使用 ADR 记录架构决策的主要好处是？",
      options: [
        "增加文档工作量",
        "让决策背景和取舍可追溯，便于后续复盘",
        "替代代码评审",
        "减少团队讨论"
      ],
      answer: 1,
      rationale: "ADR 能结构化记录决策的背景、选项和取舍，确保决策可追溯、可复盘，避免重复讨论已做过的决策。"
    },
    {
      id: "cto-w4-1-q2",
      question: "决定是否拆分微服务时，最关键的考量是？",
      options: [
        "微服务是行业趋势所以必须拆分",
        "根据团队规模和业务需求审慎评估分布式复杂性的权衡",
        "只要代码量大就应该拆分",
        "使用最新的技术框架"
      ],
      answer: 1,
      rationale: "微服务不是银弹，拆分会增加网络延迟、数据一致性和运维成本等复杂性。需要根据实际团队和业务情况权衡。"
    },
    {
      id: "cto-w4-1-q3",
      question: "渐进式迁移遗留系统的经典模式是？",
      options: [
        "Big Bang 一次性重写",
        "Strangler Fig Pattern——逐步替换",
        "完全放弃旧系统",
        "只做 Bug 修复不做迁移"
      ],
      answer: 1,
      rationale: "Strangler Fig Pattern 通过逐步将流量和功能从旧系统迁移到新系统，避免一次性重写的高风险。"
    }
  ],
  "cto-w4-2": [
    {
      id: "cto-w4-2-q1",
      question: "识别平台化机会的关键信号是？",
      options: [
        "团队想尝试新技术",
        "多个业务线重复建设相同的能力",
        "基础设施成本过高",
        "竞争对手在做平台化"
      ],
      answer: 1,
      rationale: "当身份认证、支付、消息等通用能力被多个业务线重复建设时，就是平台化的信号，可以通过复用降低边际成本。"
    },
    {
      id: "cto-w4-2-q2",
      question: "平台团队应如何对待内部开发者？",
      options: [
        "强制他们使用平台",
        "将内部开发者视为用户，收集反馈并持续迭代",
        "不需要沟通，直接建设",
        "只提供文档，不提供支持"
      ],
      answer: 1,
      rationale: "平台即产品的理念要求平台团队把内部开发者当作用户来服务，主动收集反馈、衡量采用率和满意度。"
    },
    {
      id: "cto-w4-2-q3",
      question: "过早平台化最大的风险是？",
      options: [
        "投入太多工程师",
        "平台与业务需求脱节，建设的能力没人用",
        "技术栈选择错误",
        "文档不够完善"
      ],
      answer: 1,
      rationale: "业务未稳定时过早抽象平台容易脱离实际需求。建议至少 3 个业务场景验证需求后再进行平台化投资。"
    }
  ]
}
