import type { LessonGuide } from "../types"
import type { QuizQuestion } from "@/lib/types"

export const week9Guides: Record<string, LessonGuide> = {
    "w9-1": {
        lessonId: "w9-1",
        background: [
            "【多仓库存模型】现代电商库存管理需要支持多仓库、多位置的库存可视化，实时追踪每个 SKU 在不同仓库的可用数量、预留数量、在途数量，支持最多 1000 个仓库/门店的库存同步。",
            "【CQRS 架构】Redis 官方推荐使用 CQRS（Command Query Responsibility Segregation）模式处理库存读写分离：写入操作（库存扣减）走主数据库保证一致性，读取操作（库存查询）走 Redis 缓存保证性能。",
            "【位置追踪】仓库管理系统（WMS）需要将仓库映射为精确的坐标系统，确保每件商品都有指定位置。移动日志记录每个接触点——收货、转移、拣货、退货——带有时间戳和用户 ID 形成完整审计链。",
            "【库存失调成本】行业研究显示库存失调每年给电商造成 8180 亿美元损失，其中 56% 来自缺货、44% 来自过量库存。平均缺货率为 8%，同时持有 20-30% 的冗余库存。",
            "【智能补货】AI 驱动的库存系统提供最优补货点建议、跨仓库库存再分配时机预测，结合 ABC/FSN 分析实现精细化库存管理。"
        ],
        keyDifficulties: [
            "【库存分配策略】订单路由需要根据库存、位置、运费成本自动选择最优仓库发货。复杂规则包括：就近发货（最短配送距离）、库存优先（优先消耗高库存仓）、成本优化（综合运费和仓储成本）。",
            "【实时库存同步】CQRS 模式下需要处理数据最终一致性：写入主库后通过 CDC（Change Data Capture）同步到 Redis 读缓存。库存变更事件需要在毫秒级传播到所有销售渠道，避免超卖。",
            "【库存预警机制】安全库存计算需要考虑历史销量、供应商交货周期、季节性波动。低库存告警、缺货预测、自动补货触发需要结合业务规则和机器学习模型。",
            "【库存调拨流程】仓间调拨涉及出库单、在途库存、入库确认三个状态，需要保证调拨过程中库存数据的一致性。支持批量调拨、紧急调拨、定时调拨等多种模式。",
            "【多渠道库存管理】全渠道零售需要统一管理线上商城、线下门店、第三方平台（天猫、京东、亚马逊）的库存，支持渠道专属库存和共享库存策略。"
        ],
        handsOnPath: [
            "设计多仓库存数据模型：创建 warehouses、inventory_items、inventory_transactions 表，支持 SKU 级别的多仓库存追踪。",
            "使用 Redis 实现库存缓存层：将热门 SKU 的可用库存缓存到 Redis Hash，设计缓存更新策略（写透、写回、失效）。",
            "实现库存扣减的原子操作：使用 Redis Lua 脚本或 WATCH/MULTI 事务保证并发安全，处理库存不足的回滚逻辑。",
            "开发库存预警服务：监控库存水位，当低于安全库存时触发告警通知，支持邮件、短信、Webhook 多种通知渠道。",
            "实现订单仓库分配算法：根据收货地址、各仓库存、运费规则计算最优发货仓，支持拆单发货（一单多仓）。",
            "搭建库存数据同步管道：使用 Debezium 或 Canal 实现 MySQL 到 Redis 的 CDC 同步，保证读缓存的最终一致性。"
        ],
        selfCheck: [
            "多仓库存系统中，可用库存、预留库存、在途库存分别代表什么？如何计算可售库存？",
            "CQRS 模式在库存管理中的读写分离如何实现？为什么库存扣减必须走主库？",
            "如何设计库存分配算法选择最优发货仓？需要考虑哪些因素？",
            "库存预警的安全库存如何计算？需要考虑哪些变量？",
            "如何处理拆单发货场景（订单商品来自多个仓库）？",
            "CDC 同步到 Redis 时如何保证数据最终一致性？出现同步延迟时如何处理？",
            "全渠道库存管理中，如何避免不同渠道之间的超卖问题？"
        ],
        extensions: [
            "研究 Shopify 的多位置库存管理架构，了解其如何支持最多 1000 个位置的库存同步。",
            "探索 Redis Streams 在库存事件驱动架构中的应用，实现库存变更的发布订阅。",
            "学习 AWS 或阿里云的仓储管理解决方案，了解企业级 WMS 系统的核心功能。",
            "研究 Kafka Connect 和 Debezium 实现数据库变更捕获的最佳实践。"
        ],
        sourceUrls: [
            "https://redis.io/learn/howtos/solutions/microservices/cqrs",
            "https://www.shipbob.com/ecommerce-inventory/guide/",
            "https://www.scnsoft.com/ecommerce/inventory-management-software"
        ]
    },
    "w9-2": {
        lessonId: "w9-2",
        background: [
            "【快递100 API】快递100 提供一站式物流 API 服务，核心功能包括：实时快递查询、快递信息推送、电子面单（下单/复打/取消）、智能地址解析、物流时效预估、快递面单 OCR 识别。",
            "【ShipEngine 平台】ShipEngine 提供多承运商集成能力：运费比价、标签生成、包裹追踪、地址验证。支持 REST API、Postman 集合、OpenAPI 3.0 定义，提供沙箱环境测试。",
            "【电子面单流程】电子面单完整生命周期包括：获取面单号 -> 打印面单 -> 揽收包裹 -> 运输跟踪 -> 签收确认。支持第三方电商平台账号授权，实现多店铺统一管理。",
            "【API 认证机制】物流 API 通常采用 API Key + Secret 签名认证，请求需要携带时间戳、签名等参数。部分 API 支持 OAuth2 授权获取 Access Token。",
            "【多承运商抽象】ShipEngine 等平台将不同物流公司的 API 抽象为统一接口，开发者只需对接一套 API 即可使用 USPS、UPS、FedEx、DHL 等多家承运商服务。"
        ],
        keyDifficulties: [
            "【API 适配层设计】不同物流公司 API 差异大（参数格式、返回结构、错误码），需要设计适配层（Adapter Pattern）统一封装，对上层业务提供一致的接口。",
            "【异步回调处理】物流状态变更通过 Webhook 推送，需要处理：签名验证、幂等消费、失败重试、超时处理。回调 URL 必须支持 HTTPS 且响应时间 < 5 秒。",
            "【电子面单对账】面单使用量需要与物流公司对账，处理：面单作废退回、面单有效期管理、月结账单核对。需要维护面单号池和使用状态。",
            "【限流与容错】物流 API 通常有调用频率限制（QPS），需要实现请求限流、失败重试（指数退避）、熔断降级。批量查询应合并请求减少 API 调用次数。",
            "【多租户隔离】SaaS 电商平台需要支持商家各自的物流账号配置，实现 API 凭证的租户隔离和安全存储。"
        ],
        handsOnPath: [
            "设计物流服务抽象接口：定义统一的 ShippingProvider 接口，包含 createOrder、cancelOrder、getTracking、getRate 等方法。",
            "实现快递100 API 集成：封装查询接口和推送订阅，处理签名生成、响应解析、错误重试逻辑。",
            "实现 ShipEngine API 集成：对接运费计算、标签生成、追踪查询接口，使用沙箱环境进行测试。",
            "开发 Webhook 接收端点：实现物流状态推送的接收、验签、处理逻辑，保证幂等性和可靠性。",
            "构建物流服务工厂：根据配置动态选择物流提供商，支持运行时切换和 A/B 测试。",
            "实现 API 调用监控：记录每次 API 调用的耗时、状态码、错误信息，配置告警规则。"
        ],
        selfCheck: [
            "为什么需要设计物流 API 适配层？适配器模式如何应用于多承运商集成？",
            "物流 Webhook 回调如何保证幂等性？重复推送如何处理？",
            "电子面单的完整生命周期包含哪些状态？面单作废如何处理？",
            "物流 API 签名验证的流程是什么？如何防止请求伪造？",
            "如何实现物流 API 的限流和熔断？失败重试策略如何设计？",
            "多租户场景下物流账号凭证如何安全存储？"
        ],
        extensions: [
            "研究顺丰开放平台的 API 文档，了解国内头部物流公司的 API 设计风格。",
            "探索 Shippo、EasyPost 等国际物流聚合平台的技术架构。",
            "学习 gRPC 在物流服务间通信中的应用，对比 REST API 的优劣。",
            "研究物流 TMS（Transportation Management System）系统的核心功能模块。"
        ],
        sourceUrls: [
            "https://api.kuaidi100.com/document/",
            "https://www.shipengine.com/docs/",
            "https://open.sf-express.com/"
        ]
    },
    "w9-3": {
        lessonId: "w9-3",
        background: [
            "【运费计算公式】运费成本 = 包装成本(P) + 承运商运费(S) + 处理费(H)。承运商运费由包裹重量、尺寸、目的地、配送速度决定，还需考虑燃油附加费、偏远地区附加费。",
            "【体积重量计算】承运商使用 DIM Weight（体积重量）对轻泡货物计费：DIM Weight = 长 x 宽 x 高 / DIM 因子。大多数承运商 DIM 因子为 139（英寸）或 5000（厘米）。计费重量取实际重量和体积重量的较大值。",
            "【运费策略类型】常见运费策略包括：实时运费（从承运商 API 获取精确报价）、固定运费（按订单金额或商品类别收取固定费用）、免运费（满额包邮、会员包邮）、分区运费（按配送区域设置不同费率）。",
            "【行政区划编码】中国行政区划采用 GB/T 2260 标准，6 位数字编码：前 2 位省级、3-4 位地级、5-6 位县级。运费模板需要支持按省、市、区三级设置不同费率。",
            "【附加费用】运费还包括：燃油附加费（随油价波动）、偏远地区附加费、超大超重附加费、住宅配送附加费、签名确认费、保险费等。节假日期间可能有额外附加费。"
        ],
        keyDifficulties: [
            "【运费模板设计】支持多种计费方式：按件计费、按重量计费、按体积计费、首重+续重。模板需要支持区域分组、商品分类、时间段等维度的差异化定价。",
            "【实时运费集成】对接多家承运商的实时运费 API，在结账页面展示多个配送选项和价格。需要处理 API 超时、降级到预估运费的容错逻辑。",
            "【包裹拆分计算】大订单可能需要拆成多个包裹发货，运费计算需要考虑：包裹数量、单包裹限重、最优装箱方案（3D Bin Packing）。",
            "【跨境运费】国际配送涉及更多因素：海关申报、关税预估、DDP/DDU 贸易条款、违禁品检测。不同国家的清关政策和费用结构差异大。",
            "【运费促销规则】满额包邮、指定商品包邮、会员专属运费等促销规则与运费计算的优先级和叠加逻辑需要清晰定义。"
        ],
        handsOnPath: [
            "设计运费模板数据模型：创建 shipping_templates、shipping_regions、shipping_rules 表，支持多维度运费规则配置。",
            "实现基础运费计算器：根据收货地址、商品重量/体积、运费模板计算运费，支持首重续重、分区计费。",
            "集成实时运费 API：对接 ShipEngine 或类似平台获取实时运费报价，实现多承运商运费比较展示。",
            "开发体积重量计算模块：根据商品包装尺寸计算 DIM Weight，与实际重量比较取较大值作为计费重量。",
            "实现运费促销引擎：支持满额包邮、指定区域包邮、会员免运费等规则，与购物车优惠计算集成。",
            "构建运费模板管理后台：提供可视化界面配置区域分组、费率规则、生效时间等参数。"
        ],
        selfCheck: [
            "运费计算需要考虑哪些成本因素？燃油附加费和偏远地区附加费如何处理？",
            "什么是体积重量（DIM Weight）？为什么承运商要使用体积重量计费？",
            "运费模板如何支持按重量阶梯计费（首重+续重）？",
            "实时运费 API 超时时如何降级处理？预估运费如何计算？",
            "满额包邮规则如何与其他运费规则配合？优先级如何确定？",
            "跨境电商运费计算需要额外考虑哪些因素？"
        ],
        extensions: [
            "研究 Shopify 的运费设置功能，了解其如何简化商家的运费配置。",
            "探索 3D Bin Packing 算法在包裹装箱优化中的应用。",
            "学习 Flexport 等跨境物流平台的费率计算和报关流程。",
            "研究智能运费优化：根据历史数据预测最优承运商和配送时效。"
        ],
        sourceUrls: [
            "https://www.shopify.com/blog/common-shipping-questions",
            "https://www.shipbob.com/ecommerce-shipping/calculate-shipping-costs/",
            "https://blog.shipperhq.com/2024/08/how-to-calculate-shipping-rates/"
        ]
    },
    "w9-4": {
        lessonId: "w9-4",
        background: [
            "【物流轨迹推送】快递100 提供物流轨迹订阅推送服务：订阅运单号后，物流状态变更时主动推送到商家回调 URL。推送内容包含时间、地点、操作描述、状态码等信息。",
            "【Webhook 最佳实践】Stripe 官方 Webhook 最佳实践：使用 HTTPS、验证签名防伪造、快速返回 2xx 响应（复杂逻辑异步处理）、实现幂等消费、处理重试和乱序。",
            "【订单状态机】Adobe Commerce 定义电商订单状态机：Pending（待处理）-> Processing（处理中）-> Complete（已完成）。发货后订单状态变更为已发货，签收确认后变更为已完成。",
            "【轨迹状态码】物流轨迹状态码标准化：揽收、运输中、派送中、已签收、异常（拒收/退回/滞留）。不同物流公司状态码需要映射到统一的内部状态。",
            "【签收确认流程】签收方式包括：本人签收、代收、快递柜自提、驿站代收。需要记录签收时间、签收人、签收凭证（签名/照片），支持签收异常申诉。"
        ],
        keyDifficulties: [
            "【Webhook 幂等处理】物流推送可能重复发送，需要基于 message_id 或业务单号去重。使用 Redis SETNX 或数据库唯一索引保证幂等，避免重复更新订单状态。",
            "【状态码映射】不同物流公司使用不同的状态码体系，需要建立映射表将外部状态码转换为内部统一状态。处理未知状态码的兜底逻辑。",
            "【签收异常处理】签收异常场景包括：拒收、部分签收、货损、地址错误退回。需要触发售后流程、库存回补、通知商家等后续操作。",
            "【轨迹数据存储】物流轨迹数据量大且查询频繁，需要设计合理的存储方案：热数据存 Redis、历史数据存时序数据库或归档到对象存储。",
            "【用户通知触发】关键物流节点需要触发用户通知：已发货、派送中、已签收。通知渠道包括短信、App 推送、公众号消息，需要控制通知频率避免骚扰。"
        ],
        handsOnPath: [
            "设计物流轨迹数据模型：创建 shipment_trackings、tracking_events 表，存储运单轨迹历史和最新状态。",
            "实现 Webhook 接收服务：开发 /webhook/logistics 端点接收物流推送，实现签名验证、幂等处理、异步入库。",
            "开发状态码映射服务：维护物流公司状态码到内部状态的映射配置，支持动态更新和未知状态告警。",
            "实现订单状态联动：物流签收后自动更新订单状态为已完成，触发评价邀请、积分发放等后续流程。",
            "构建轨迹查询 API：提供给前端的轨迹查询接口，支持时间线展示、地图轨迹可视化。",
            "开发用户通知服务：关键物流节点触发短信/推送通知，集成短信网关和 App 推送服务。"
        ],
        selfCheck: [
            "物流 Webhook 推送如何验证签名防止伪造？验签失败如何处理？",
            "如何保证 Webhook 消费的幂等性？重复推送如何去重？",
            "物流状态码映射表如何设计？遇到未知状态码如何处理？",
            "签收异常（拒收、货损）发生后需要触发哪些后续流程？",
            "物流轨迹数据的存储方案如何设计？热数据和历史数据如何区分处理？",
            "哪些物流节点需要触发用户通知？如何避免通知过于频繁？"
        ],
        extensions: [
            "研究 Kafka 在物流事件流处理中的应用，实现高吞吐的轨迹数据处理管道。",
            "探索时序数据库（InfluxDB、TimescaleDB）在物流轨迹存储中的应用。",
            "学习 OpenStreetMap 和 Mapbox 实现物流轨迹的地图可视化。",
            "研究智能物流预测：基于历史轨迹数据预测到达时间和配送异常。"
        ],
        sourceUrls: [
            "https://api.kuaidi100.com/document/",
            "https://docs.stripe.com/webhooks/best-practices",
            "https://experienceleague.adobe.com/en/docs/commerce-admin/stores-sales/order-management/orders/order-processing"
        ]
    }
}

export const week9Quizzes: Record<string, QuizQuestion[]> = {
    "w9-1": [
        {
            id: "w9-1-q1",
            question: "CQRS 模式在库存管理中的核心思想是什么？",
            options: [
                "所有操作都走缓存",
                "读写分离：写入走主库保证一致性，读取走缓存保证性能",
                "所有操作都走数据库",
                "只使用消息队列处理"
            ],
            answer: 1,
            rationale: "Redis 官方推荐 CQRS 模式：Commands（写入）走主数据库保证一致性和持久化，Queries（读取）走 Redis 缓存保证性能。"
        },
        {
            id: "w9-1-q2",
            question: "库存失调（Inventory Distortion）每年给电商行业造成多少损失？",
            options: [
                "约 100 亿美元",
                "约 500 亿美元",
                "约 8180 亿美元",
                "约 1 万亿美元"
            ],
            answer: 2,
            rationale: "行业研究显示库存失调每年给电商造成约 8180 亿美元损失，其中 56% 来自缺货、44% 来自过量库存。"
        },
        {
            id: "w9-1-q3",
            question: "多仓库存分配时，订单路由需要考虑哪些因素？",
            options: [
                "只考虑库存数量",
                "只考虑距离远近",
                "库存数量、配送距离、运费成本等综合因素",
                "只考虑仓库大小"
            ],
            answer: 2,
            rationale: "订单路由需要综合考虑：库存数量（是否有货）、配送距离（就近发货）、运费成本（成本优化）等多个因素选择最优发货仓。"
        },
        {
            id: "w9-1-q4",
            question: "CDC（Change Data Capture）在库存系统中的作用是什么？",
            options: [
                "直接修改缓存数据",
                "捕获主库变更并同步到读缓存，保证最终一致性",
                "删除过期数据",
                "压缩存储空间"
            ],
            answer: 1,
            rationale: "CDC 用于捕获主数据库的变更事件，将库存更新实时同步到 Redis 读缓存，实现读写分离下的数据最终一致性。"
        },
        {
            id: "w9-1-q5",
            question: "使用 Redis 实现库存扣减时，如何保证并发安全？",
            options: [
                "直接使用 GET + SET 操作",
                "使用 Lua 脚本或 WATCH/MULTI 事务保证原子性",
                "不需要特殊处理",
                "使用定时任务同步"
            ],
            answer: 1,
            rationale: "并发库存扣减需要使用 Redis Lua 脚本或 WATCH/MULTI 事务保证操作的原子性，防止超卖问题。"
        },
        {
            id: "w9-1-q6",
            question: "全渠道库存管理需要解决什么核心问题？",
            options: [
                "商品图片同步",
                "统一管理多渠道库存，避免超卖",
                "用户评价同步",
                "订单号统一"
            ],
            answer: 1,
            rationale: "全渠道零售需要统一管理线上商城、线下门店、第三方平台的库存，支持渠道专属库存和共享库存策略，避免超卖。"
        },
        {
            id: "w9-1-q7",
            question: "仓库管理系统（WMS）中的位置追踪记录哪些信息？",
            options: [
                "只记录库存数量",
                "收货、转移、拣货、退货等操作，带时间戳和操作人",
                "只记录价格变化",
                "只记录订单信息"
            ],
            answer: 1,
            rationale: "WMS 的移动日志记录每个接触点——收货、转移、拣货、退货——带有时间戳和用户 ID 形成完整审计链。"
        },
        {
            id: "w9-1-q8",
            question: "库存预警的安全库存计算需要考虑哪些因素？",
            options: [
                "只考虑当前库存",
                "历史销量、供应商交货周期、季节性波动",
                "只考虑商品价格",
                "只考虑仓库容量"
            ],
            answer: 1,
            rationale: "安全库存计算需要综合考虑历史销量趋势、供应商交货周期（Lead Time）、季节性波动等因素。"
        },
        {
            id: "w9-1-q9",
            question: "Shopify 的多位置库存管理最多支持多少个仓库/门店？",
            options: [
                "100 个",
                "500 个",
                "1000 个",
                "无限制"
            ],
            answer: 2,
            rationale: "Shopify 支持多位置库存管理，可以在最多 1000 个仓库、配送中心和门店之间高效分配库存。"
        },
        {
            id: "w9-1-q10",
            question: "库存调拨流程涉及哪三个核心状态？",
            options: [
                "下单、支付、发货",
                "出库单、在途库存、入库确认",
                "创建、审核、完成",
                "预约、执行、结算"
            ],
            answer: 1,
            rationale: "仓间调拨涉及出库单（源仓出库）、在途库存（运输中）、入库确认（目标仓入库）三个状态，需要保证数据一致性。"
        },
        {
            id: "w9-1-q11",
            question: "AI 驱动的库存系统提供哪些智能功能？",
            options: [
                "只提供报表",
                "最优补货点建议、跨仓库库存再分配、ABC/FSN 分析",
                "只提供告警",
                "只提供搜索"
            ],
            answer: 1,
            rationale: "AI 驱动的库存系统提供最优补货点建议、跨仓库库存再分配时机预测，结合 ABC/FSN 分析实现精细化管理。"
        },
        {
            id: "w9-1-q12",
            question: "电商行业平均缺货率和冗余库存率分别是多少？",
            options: [
                "缺货率 2%，冗余库存 5%",
                "缺货率 8%，冗余库存 20-30%",
                "缺货率 15%，冗余库存 50%",
                "缺货率 1%，冗余库存 10%"
            ],
            answer: 1,
            rationale: "研究显示电商平均缺货率为 8%，同时持有 20-30% 的冗余库存，库存管理优化空间很大。"
        }
    ],
    "w9-2": [
        {
            id: "w9-2-q1",
            question: "快递100 API 提供的核心功能不包括以下哪项？",
            options: [
                "实时快递查询",
                "电子面单服务",
                "支付处理",
                "智能地址解析"
            ],
            answer: 2,
            rationale: "快递100 提供快递查询、电子面单、地址解析、时效预估等物流服务，不涉及支付处理功能。"
        },
        {
            id: "w9-2-q2",
            question: "ShipEngine 平台的核心价值是什么？",
            options: [
                "只支持单一承运商",
                "多承运商抽象为统一 API，一次对接使用多家服务",
                "只提供追踪功能",
                "只提供报表功能"
            ],
            answer: 1,
            rationale: "ShipEngine 将不同物流公司的 API 抽象为统一接口，开发者只需对接一套 API 即可使用 USPS、UPS、FedEx、DHL 等多家服务。"
        },
        {
            id: "w9-2-q3",
            question: "物流 API 适配层设计采用什么设计模式？",
            options: [
                "单例模式",
                "适配器模式（Adapter Pattern）",
                "观察者模式",
                "工厂模式"
            ],
            answer: 1,
            rationale: "不同物流公司 API 差异大，需要使用适配器模式（Adapter Pattern）统一封装，对上层业务提供一致的接口。"
        },
        {
            id: "w9-2-q4",
            question: "物流 Webhook 回调的响应时间要求是什么？",
            options: [
                "无限制",
                "小于 5 秒，复杂逻辑异步处理",
                "小于 1 分钟",
                "小于 30 秒"
            ],
            answer: 1,
            rationale: "Webhook 回调 URL 必须快速返回 2xx 响应（通常要求 < 5 秒），复杂业务逻辑应该异步处理。"
        },
        {
            id: "w9-2-q5",
            question: "电子面单的完整生命周期包含哪些环节？",
            options: [
                "只有打印和发货",
                "获取面单号 -> 打印 -> 揽收 -> 运输跟踪 -> 签收确认",
                "只有查询",
                "只有创建和取消"
            ],
            answer: 1,
            rationale: "电子面单完整生命周期：获取面单号 -> 打印面单 -> 揽收包裹 -> 运输跟踪 -> 签收确认，还支持作废和复打。"
        },
        {
            id: "w9-2-q6",
            question: "物流 API 调用的容错策略应包含哪些？",
            options: [
                "只需要重试",
                "请求限流、失败重试（指数退避）、熔断降级",
                "只需要缓存",
                "不需要容错"
            ],
            answer: 1,
            rationale: "物流 API 通常有 QPS 限制，需要实现请求限流、失败重试（指数退避）、熔断降级等容错策略。"
        },
        {
            id: "w9-2-q7",
            question: "SaaS 电商平台的物流账号管理需要解决什么问题？",
            options: [
                "账号共享",
                "多租户隔离，各商家使用各自的物流账号",
                "统一使用平台账号",
                "不支持多商家"
            ],
            answer: 1,
            rationale: "SaaS 电商平台需要支持商家各自的物流账号配置，实现 API 凭证的租户隔离和安全存储。"
        },
        {
            id: "w9-2-q8",
            question: "物流 API 签名验证的目的是什么？",
            options: [
                "加速请求",
                "防止请求伪造，确保请求来源可信",
                "压缩数据",
                "记录日志"
            ],
            answer: 1,
            rationale: "签名验证通过 API Key + Secret 生成签名，验证请求确实来自合法调用方，防止伪造请求。"
        },
        {
            id: "w9-2-q9",
            question: "批量物流查询时的优化策略是什么？",
            options: [
                "每个运单单独查询",
                "合并请求减少 API 调用次数",
                "不做优化",
                "全部缓存"
            ],
            answer: 1,
            rationale: "批量查询应合并请求减少 API 调用次数，降低触发限流的风险，提高查询效率。"
        },
        {
            id: "w9-2-q10",
            question: "ShipEngine 提供的开发者资源包括什么？",
            options: [
                "只有文档",
                "REST API 文档、Postman 集合、OpenAPI 定义、沙箱环境",
                "只有 SDK",
                "只有示例代码"
            ],
            answer: 1,
            rationale: "ShipEngine 提供完整的开发者资源：REST API 文档、Postman 集合、OpenAPI 3.0 定义、JSON schemas 和沙箱测试环境。"
        },
        {
            id: "w9-2-q11",
            question: "物流 API 重试策略中的「指数退避」是什么意思？",
            options: [
                "立即重试",
                "每次重试间隔时间指数增长（如 1s, 2s, 4s, 8s）",
                "固定间隔重试",
                "不重试"
            ],
            answer: 1,
            rationale: "指数退避（Exponential Backoff）是指每次重试的间隔时间指数增长，避免对已过载的服务造成更大压力。"
        },
        {
            id: "w9-2-q12",
            question: "电子面单对账需要处理哪些情况？",
            options: [
                "只处理正常使用",
                "面单作废退回、有效期管理、月结账单核对",
                "只处理打印",
                "不需要对账"
            ],
            answer: 1,
            rationale: "面单使用量需要与物流公司对账，处理：面单作废退回、面单有效期管理、月结账单核对，维护面单号池和使用状态。"
        }
    ],
    "w9-3": [
        {
            id: "w9-3-q1",
            question: "运费计算的基本公式是什么？",
            options: [
                "运费 = 重量 x 单价",
                "运费 = 包装成本(P) + 承运商运费(S) + 处理费(H)",
                "运费 = 距离 x 单价",
                "运费 = 固定费用"
            ],
            answer: 1,
            rationale: "运费成本 = 包装成本(P) + 承运商运费(S) + 处理费(H)，承运商运费由重量、尺寸、目的地、配送速度决定。"
        },
        {
            id: "w9-3-q2",
            question: "体积重量（DIM Weight）的计算公式是什么？",
            options: [
                "长 + 宽 + 高",
                "长 x 宽 x 高 / DIM 因子",
                "长 x 宽",
                "周长 x 2"
            ],
            answer: 1,
            rationale: "DIM Weight = 长 x 宽 x 高 / DIM 因子。大多数承运商 DIM 因子为 139（英寸）或 5000（厘米）。"
        },
        {
            id: "w9-3-q3",
            question: "为什么承运商要使用体积重量计费？",
            options: [
                "简化计算",
                "对轻泡货物按占用空间收费，而非实际重量",
                "统一定价",
                "降低成本"
            ],
            answer: 1,
            rationale: "轻泡货物（体积大但重量轻）占用运输空间大，承运商使用 DIM Weight 按空间收费，取实际重量和体积重量的较大值计费。"
        },
        {
            id: "w9-3-q4",
            question: "常见的运费策略类型不包括以下哪项？",
            options: [
                "实时运费",
                "固定运费",
                "随机运费",
                "免运费"
            ],
            answer: 2,
            rationale: "常见运费策略包括：实时运费（API 获取）、固定运费（按类别收费）、免运费（满额包邮）、分区运费，不存在随机运费。"
        },
        {
            id: "w9-3-q5",
            question: "中国行政区划编码（GB/T 2260）的结构是什么？",
            options: [
                "4 位数字",
                "6 位数字：前 2 位省级、3-4 位地级、5-6 位县级",
                "8 位数字",
                "字母编码"
            ],
            answer: 1,
            rationale: "中国行政区划采用 GB/T 2260 标准，6 位数字编码：前 2 位省级、3-4 位地级、5-6 位县级。"
        },
        {
            id: "w9-3-q6",
            question: "运费附加费用不包括以下哪项？",
            options: [
                "燃油附加费",
                "偏远地区附加费",
                "商品折扣",
                "住宅配送附加费"
            ],
            answer: 2,
            rationale: "运费附加费包括：燃油附加费、偏远地区附加费、超大超重附加费、住宅配送附加费、签名确认费等，商品折扣不属于运费。"
        },
        {
            id: "w9-3-q7",
            question: "运费模板支持的计费方式包括哪些？",
            options: [
                "只支持按件计费",
                "按件计费、按重量计费、按体积计费、首重+续重",
                "只支持固定费用",
                "只支持免费配送"
            ],
            answer: 1,
            rationale: "运费模板支持多种计费方式：按件计费、按重量计费、按体积计费、首重+续重等，满足不同商品的运费计算需求。"
        },
        {
            id: "w9-3-q8",
            question: "实时运费 API 超时时应该如何处理？",
            options: [
                "显示错误信息",
                "降级到预估运费",
                "取消订单",
                "无限等待"
            ],
            answer: 1,
            rationale: "实时运费 API 超时时应降级到预估运费，基于历史数据或配置的默认费率计算，保证用户体验。"
        },
        {
            id: "w9-3-q9",
            question: "大订单拆分发货时，运费计算需要考虑什么？",
            options: [
                "只按总重量计算",
                "包裹数量、单包裹限重、最优装箱方案",
                "只按商品数量计算",
                "不需要特殊处理"
            ],
            answer: 1,
            rationale: "大订单可能需要拆成多个包裹，运费计算需要考虑：包裹数量、单包裹限重、最优装箱方案（3D Bin Packing）。"
        },
        {
            id: "w9-3-q10",
            question: "跨境运费计算需要额外考虑哪些因素？",
            options: [
                "只考虑重量",
                "海关申报、关税预估、贸易条款、违禁品检测",
                "只考虑距离",
                "不需要额外考虑"
            ],
            answer: 1,
            rationale: "跨境运费涉及更多因素：海关申报、关税预估、DDP/DDU 贸易条款、违禁品检测，不同国家政策差异大。"
        },
        {
            id: "w9-3-q11",
            question: "研究显示，多少比例的购物者会因运费过高而放弃购物车？",
            options: [
                "约 20%",
                "约 40%",
                "约 60%",
                "约 80%"
            ],
            answer: 2,
            rationale: "研究显示近 60% 的购物者会因运费过高而放弃购物车，合理的运费策略对转化率至关重要。"
        },
        {
            id: "w9-3-q12",
            question: "运费促销规则与运费计算的关系应该如何处理？",
            options: [
                "运费促销优先级最低",
                "需要明确定义优先级和叠加逻辑",
                "促销规则不影响运费",
                "只能使用一种规则"
            ],
            answer: 1,
            rationale: "满额包邮、指定商品包邮、会员专属运费等促销规则与运费计算的优先级和叠加逻辑需要清晰定义。"
        }
    ],
    "w9-4": [
        {
            id: "w9-4-q1",
            question: "快递100 物流轨迹推送的工作方式是什么？",
            options: [
                "客户端定时轮询",
                "订阅运单号后，状态变更时主动推送到回调 URL",
                "手动查询",
                "邮件通知"
            ],
            answer: 1,
            rationale: "快递100 提供物流轨迹订阅推送服务：订阅运单号后，物流状态变更时主动推送到商家配置的回调 URL。"
        },
        {
            id: "w9-4-q2",
            question: "Stripe 官方 Webhook 最佳实践建议如何处理复杂逻辑？",
            options: [
                "在回调中同步处理",
                "快速返回 2xx 响应，复杂逻辑异步处理",
                "不处理复杂逻辑",
                "延迟返回响应"
            ],
            answer: 1,
            rationale: "Stripe 建议：快速返回 2xx 响应（在复杂逻辑之前），复杂业务逻辑应该异步处理，避免超时。"
        },
        {
            id: "w9-4-q3",
            question: "Adobe Commerce 定义的订单状态流转顺序是什么？",
            options: [
                "Complete -> Processing -> Pending",
                "Pending -> Processing -> Complete",
                "Processing -> Pending -> Complete",
                "Pending -> Complete -> Processing"
            ],
            answer: 1,
            rationale: "Adobe Commerce 订单状态机：Pending（待处理）-> Processing（处理中）-> Complete（已完成）。"
        },
        {
            id: "w9-4-q4",
            question: "如何保证 Webhook 消费的幂等性？",
            options: [
                "不需要处理",
                "基于 message_id 或业务单号去重，使用 Redis SETNX 或唯一索引",
                "直接覆盖旧数据",
                "全部丢弃"
            ],
            answer: 1,
            rationale: "物流推送可能重复发送，需要基于 message_id 或业务单号去重，使用 Redis SETNX 或数据库唯一索引保证幂等。"
        },
        {
            id: "w9-4-q5",
            question: "物流状态码映射需要解决什么问题？",
            options: [
                "统一显示格式",
                "将不同物流公司的状态码转换为内部统一状态",
                "压缩数据",
                "加密传输"
            ],
            answer: 1,
            rationale: "不同物流公司使用不同的状态码体系，需要建立映射表将外部状态码转换为内部统一状态，便于业务处理。"
        },
        {
            id: "w9-4-q6",
            question: "签收异常场景包括哪些？",
            options: [
                "只有正常签收",
                "拒收、部分签收、货损、地址错误退回",
                "只有延迟",
                "只有丢件"
            ],
            answer: 1,
            rationale: "签收异常场景包括：拒收、部分签收、货损、地址错误退回等，需要触发售后流程、库存回补、通知商家等后续操作。"
        },
        {
            id: "w9-4-q7",
            question: "物流轨迹数据的存储策略建议是什么？",
            options: [
                "全部存数据库",
                "热数据存 Redis、历史数据存时序数据库或归档",
                "全部存文件",
                "不存储"
            ],
            answer: 1,
            rationale: "物流轨迹数据量大且查询频繁，建议热数据存 Redis、历史数据存时序数据库或归档到对象存储。"
        },
        {
            id: "w9-4-q8",
            question: "哪些物流节点需要触发用户通知？",
            options: [
                "每个节点都通知",
                "已发货、派送中、已签收等关键节点",
                "不需要通知",
                "只通知异常"
            ],
            answer: 1,
            rationale: "关键物流节点需要触发用户通知：已发货、派送中、已签收。需要控制通知频率避免骚扰用户。"
        },
        {
            id: "w9-4-q9",
            question: "Webhook 签名验证失败时应该如何处理？",
            options: [
                "继续处理请求",
                "拒绝请求并记录告警日志",
                "忽略验证",
                "自动重试"
            ],
            answer: 1,
            rationale: "签名验证失败说明请求可能是伪造的，应该拒绝处理并记录告警日志，便于安全分析。"
        },
        {
            id: "w9-4-q10",
            question: "物流签收后应该触发哪些后续流程？",
            options: [
                "无后续流程",
                "更新订单状态、触发评价邀请、发放积分",
                "只更新状态",
                "只发送通知"
            ],
            answer: 1,
            rationale: "物流签收后自动更新订单状态为已完成，触发评价邀请、积分发放等后续流程，提升用户体验和复购。"
        },
        {
            id: "w9-4-q11",
            question: "遇到未知物流状态码时应该如何处理？",
            options: [
                "直接报错",
                "使用兜底逻辑，记录日志并告警",
                "忽略该状态",
                "删除记录"
            ],
            answer: 1,
            rationale: "遇到未知状态码应使用兜底逻辑（如映射为「运输中」），同时记录日志并触发告警，便于及时补充映射规则。"
        },
        {
            id: "w9-4-q12",
            question: "签收方式包括哪些类型？",
            options: [
                "只有本人签收",
                "本人签收、代收、快递柜自提、驿站代收",
                "只有快递员送达",
                "只有自提"
            ],
            answer: 1,
            rationale: "签收方式包括：本人签收、代收、快递柜自提、驿站代收等，需要记录签收时间、签收人、签收凭证。"
        }
    ]
}
