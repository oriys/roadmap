import type { LessonGuide } from "../types"
import type { QuizQuestion } from "@/lib/types"

export const week2Guides: Record<string, LessonGuide> = {
  "bc-w2-1": {
    lessonId: "bc-w2-1",
    background: [
      "【椭圆曲线密码】区块链普遍使用 ECDSA（基于 secp256k1 曲线）生成密钥对。私钥是一个 256 位随机数，公钥由私钥经椭圆曲线标量乘法导出，反向计算不可行。",
      "【哈希函数】SHA-256、Keccak-256 等密码学哈希函数具有抗碰撞性、单向性和雪崩效应，是区块链中地址生成、交易指纹和 Merkle 树的基础。",
      "【数字签名】发送方用私钥对交易哈希签名，任何人可用对应公钥验证签名合法性。签名保证交易不可伪造且不可否认。",
      "【随机数安全】ECDSA 签名过程中需要一个不可预测的随机数 k。若 k 重复或可预测，攻击者可反推出私钥，历史上多次因此导致资金损失。",
      "【哈希碰撞风险】虽然 SHA-256 的碰撞概率极低（2^128 次尝试），但弱哈希函数（如 MD5、SHA-1）已被攻破，选择安全的哈希算法至关重要。"
    ],
    keyDifficulties: [
      "【secp256k1 曲线参数】比特币和以太坊都使用 secp256k1 曲线，其安全性来自椭圆曲线离散对数问题（ECDLP）的计算困难性。",
      "【私钥熵源】私钥生成需要高质量随机源（如 /dev/urandom 或硬件随机数生成器）。低熵会导致私钥可预测，从而被暴力破解。",
      "【签名可延展性】原始比特币协议中，签名可以被第三方修改（不改变有效性），导致交易哈希变化。SegWit 通过将签名移出交易哈希解决此问题。",
      "【量子威胁】量子计算机的 Shor 算法理论上可以破解椭圆曲线密码。后量子密码学（如格密码）是未来的研究方向。"
    ],
    handsOnPath: [
      "使用 OpenSSL 或 Python 的 ecdsa 库生成一对 secp256k1 密钥，观察私钥和公钥的格式与长度。",
      "用 SHA-256 对一段文本计算哈希，修改一个字符后再次计算，体会雪崩效应。",
      "使用生成的私钥对一段消息签名，再用公钥验证签名，感受完整的签名验证流程。",
      "查看以太坊交易的 v、r、s 签名字段，理解 ECDSA 签名的组成部分。",
      "研究一个历史上因随机数 k 重复导致私钥泄露的真实案例。"
    ],
    selfCheck: [
      "为什么从公钥无法反推出私钥？这依赖什么数学难题？",
      "SHA-256 的哪些特性使其适合用于区块链？抗碰撞性意味着什么？",
      "ECDSA 签名中的随机数 k 如果重复使用会有什么后果？",
      "什么是签名可延展性？SegWit 如何解决这个问题？",
      "量子计算对当前区块链密码学的威胁是什么？"
    ],
    extensions: [
      "了解 Schnorr 签名方案（BIP-340）及其相比 ECDSA 的批量验证和多签优势。",
      "研究 EdDSA（Ed25519）与 ECDSA 的区别及其在 Solana 等链中的应用。",
      "探索零知识证明（ZKP）的基本概念，了解 zk-SNARK 和 zk-STARK 的区别。",
      "了解后量子密码学中的格密码（Lattice-based cryptography）基本原理。"
    ],
    sourceUrls: [
      "https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm",
      "https://en.wikipedia.org/wiki/SHA-2",
      "https://roadmap.sh/cryptography"
    ]
  },
  "bc-w2-2": {
    lessonId: "bc-w2-2",
    background: [
      "【地址生成】以太坊地址由公钥经 Keccak-256 哈希后取最后 20 字节生成。比特币地址额外经过 RIPEMD-160 和 Base58Check 编码。",
      "【助记词（BIP-39）】12 或 24 个英文单词编码钱包种子，便于人类记忆和备份。助记词经 PBKDF2 派生出种子，再生成主密钥。",
      "【HD 钱包（BIP-32）】分层确定性钱包从一个主密钥派生出无限子密钥，每次交易可使用不同地址增强隐私，同时只需备份一个助记词。",
      "【派生路径】BIP-44 定义标准化路径如 m/44'/60'/0'/0/0（以太坊）。不同链和账户通过路径区分，保证兼容性。",
      "【常见攻击面】助记词泄露、剪贴板劫持、钓鱼网站和恶意浏览器插件是钱包安全的主要威胁。硬件钱包通过隔离私钥签名来防护。"
    ],
    keyDifficulties: [
      "【BIP-39 熵与校验】助记词来自 128-256 位熵加上校验位。12 个词对应 128 位熵（2^128 种可能），安全性足够抵抗暴力破解。",
      "【硬化派生 vs 普通派生】硬化派生（索引 ≥ 2^31）使用私钥计算，泄露子公钥不会危及父私钥。普通派生如果子私钥泄露，可反推父私钥。",
      "【热钱包 vs 冷钱包】热钱包连接网络使用方便但风险高。冷钱包（硬件钱包/离线签名）隔离网络更安全，但操作不便。",
      "【多签钱包】多签（如 2-of-3）要求多个密钥共同签署交易，防止单点故障。实现方式包括链上多签合约和 MPC 方案。"
    ],
    handsOnPath: [
      "使用可信工具（如 ian coleman 的 BIP-39 工具离线版）生成助记词，观察种子和派生密钥的关系。",
      "从助记词手动推导以太坊地址：助记词 → 种子 → 主私钥 → 子私钥 → 公钥 → 地址。",
      "安装 MetaMask 浏览器插件，创建钱包并观察多个账户的地址如何从同一助记词派生。",
      "了解 Ledger 或 Trezor 硬件钱包的签名流程，理解私钥从不离开设备的安全模型。",
      "模拟一个剪贴板劫持攻击场景，理解为什么转账前必须核对完整地址。"
    ],
    selfCheck: [
      "以太坊地址是如何从公钥生成的？经过了哪些步骤？",
      "助记词的安全性来源于什么？12 个词对应多少位熵？",
      "HD 钱包的主要优势是什么？为什么只需备份一个助记词？",
      "硬化派生和普通派生有什么区别？为什么硬化派生更安全？",
      "列举三种常见的钱包攻击方式及其防护措施。"
    ],
    extensions: [
      "研究社会恢复钱包（Social Recovery Wallet）的设计理念，如 Vitalik 提出的方案。",
      "了解账户抽象（ERC-4337）如何改变钱包的用户体验和安全模型。",
      "探索 MPC（多方计算）钱包的工作原理及其相比链上多签的优势。",
      "研究 Shamir 秘密共享方案在助记词分片备份中的应用。"
    ],
    sourceUrls: [
      "https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki",
      "https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki",
      "https://roadmap.sh/blockchain"
    ]
  }
}

export const week2Quizzes: Record<string, QuizQuestion[]> = {
  "bc-w2-1": [
    {
      id: "bc-w2-1-q1",
      question: "ECDSA 签名中随机数 k 重复使用会导致什么后果？",
      options: [
        "签名验证失败",
        "攻击者可以从两个签名中反推出私钥",
        "交易被自动取消",
        "公钥失效"
      ],
      answer: 1,
      rationale: "两次签名使用相同的 k 值时，攻击者可以通过数学推导消除 k，从而计算出私钥。历史上多次真实事件因此造成资金损失。"
    },
    {
      id: "bc-w2-1-q2",
      question: "SHA-256 哈希函数的哪项特性对区块链防篡改最为关键？",
      options: [
        "输出长度可变",
        "抗碰撞性——难以找到两个不同输入产生相同哈希",
        "可逆性——能从哈希还原原文",
        "计算速度极慢"
      ],
      answer: 1,
      rationale: "抗碰撞性保证攻击者无法伪造另一笔交易获得相同哈希，从而保护链上数据的完整性。"
    },
    {
      id: "bc-w2-1-q3",
      question: "椭圆曲线密码的安全性依赖于什么数学难题？",
      options: [
        "大整数分解问题",
        "椭圆曲线离散对数问题（ECDLP）",
        "哈希碰撞问题",
        "旅行商问题"
      ],
      answer: 1,
      rationale: "ECDSA 的安全性来自椭圆曲线离散对数问题：已知基点 G 和公钥 Q=kG，在有限域上反推标量 k（私钥）在计算上不可行。"
    }
  ],
  "bc-w2-2": [
    {
      id: "bc-w2-2-q1",
      question: "BIP-39 助记词中 12 个英文单词对应多少位熵？",
      options: [
        "64 位",
        "128 位",
        "256 位",
        "512 位"
      ],
      answer: 1,
      rationale: "12 个助记词编码 128 位熵加 4 位校验位。128 位熵提供约 2^128 种可能组合，足以抵抗暴力破解。"
    },
    {
      id: "bc-w2-2-q2",
      question: "HD 钱包（BIP-32）的核心优势是？",
      options: [
        "提高交易速度",
        "从一个主密钥派生无限子密钥，只需备份一个助记词",
        "降低 gas 费用",
        "自动执行智能合约"
      ],
      answer: 1,
      rationale: "HD 钱包的分层确定性结构允许从单一种子派生整棵密钥树，每次交易可使用不同地址增强隐私，同时简化备份。"
    },
    {
      id: "bc-w2-2-q3",
      question: "硬化派生（Hardened Derivation）相比普通派生的安全优势是？",
      options: [
        "生成速度更快",
        "子公钥泄露不会危及父私钥的安全",
        "支持更多地址格式",
        "兼容所有区块链"
      ],
      answer: 1,
      rationale: "硬化派生使用私钥参与子密钥计算，即使子密钥泄露也无法反推父私钥。普通派生中子私钥泄露可结合父公钥推导出父私钥。"
    }
  ]
}
